import{g as i}from"./config.js";const l=i();chrome.runtime.onMessage.addListener((r,s,t)=>{if(console.log("Background script received message:",r),r.type==="pg_report_suspicious")return console.log("Processing suspicious link report:",r),p(r).then(e=>{console.log("Report response:",e),t(e)}).catch(e=>{console.error("Report error:",e),t({ok:!1,error:e.message})}),!0});async function p(r){return new Promise(s=>{chrome.storage.sync.get(["apiBase","tenantKey"],async t=>{try{const e=(t.apiBase||l).replace(/\/$/,""),a=t.tenantKey||"";console.log("Sending report to:",e),console.log("Report data:",r);const o=await fetch(`${e}/report`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:r.url,tenantKey:a,context:{linkText:r.linkText,pageUrl:r.pageUrl,reasons:r.reasons,timestamp:new Date().toISOString()}})});if(!o.ok){const c=await o.text();console.error("Report API error:",o.status,c),s({ok:!1,error:`API Error: ${o.status} ${o.statusText}`});return}const n=await o.json();console.log("Report successful:",n),s({ok:!0,message:n.message,reportId:n.reportId})}catch(e){console.error("Report fetch error:",e),s({ok:!1,error:e instanceof Error?e.message:"Unknown error"})}})})}chrome.runtime.onInstalled.addListener(()=>{console.log("PhishGuard Lite installed")});
