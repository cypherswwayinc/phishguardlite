import{g as a}from"./config.js";const l=a();chrome.runtime.onMessage.addListener((e,t,r)=>{if(console.log("Background script received message:",e),e.type==="pg_report_suspicious")return console.log("Processing suspicious link report:",e),p(e).then(o=>{console.log("Report response:",o),r(o)}).catch(o=>{console.error("Report error:",o),r({ok:!1,error:o.message})}),!0});chrome.action.onClicked.addListener(async e=>{if(e.id&&e.url){console.log("Extension icon clicked on tab:",e.id,e.url);const t=["mail.google.com","www.linkedin.com","linkedin.com","outlook.office.com","outlook.live.com"];try{const r=new URL(e.url);t.includes(r.hostname)?(await chrome.scripting.executeScript({target:{tabId:e.id},files:["content.js"]}),console.log("Content script activated on tab:",e.id)):console.log("Site not supported for active scanning:",r.hostname)}catch(r){console.error("Error processing tab click:",r)}}});async function p(e){return new Promise(t=>{chrome.storage.sync.get(["apiBase","tenantKey"],async r=>{try{const o=(r.apiBase||l).replace(/\/$/,""),c=r.tenantKey||"";console.log("Sending report to:",o),console.log("Report data:",e);const n=await fetch(`${o}/report`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:e.url,tenantKey:c,context:{linkText:e.linkText,pageUrl:e.pageUrl,reasons:e.reasons,timestamp:new Date().toISOString()}})});if(!n.ok){const i=await n.text();console.error("Report API error:",n.status,i),t({ok:!1,error:`API Error: ${n.status} ${n.statusText}`});return}const s=await n.json();console.log("Report successful:",s),t({ok:!0,message:s.message,reportId:s.reportId})}catch(o){console.error("Report fetch error:",o),t({ok:!1,error:o instanceof Error?o.message:"Unknown error"})}})})}chrome.runtime.onInstalled.addListener(()=>{console.log("PhishGuard Lite installed with activeTab permission")});
